<odoo>
    <data noupdate="0">

        <!-- Rule 1: User thường chỉ thấy partner của chính mình hoặc không có user_id -->
        <record id="res_partner_rule_own" model="ir.rule">
            <field name="name">Res Partner: Chỉ thấy partner của chính mình</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">
                [('user_id', '=', user.id)]
            </field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>  <!-- Áp dụng cho tất cả internal user -->
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Rule 2: Administrator thấy tất cả (global rule) -->
        <record id="res_partner_rule_admin_all" model="ir.rule">
            <field name="name">Res Partner: Admin thấy tất cả</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[(1, '=', 1)]</field>  <!-- True luôn -->
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>  <!-- Group Settings / Access Rights -->
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="group_custom_partner_manager" model="res.groups">
            <field name="name">Custom Partner Manager</field>
             <field name="user_ids" eval="[Command.link(ref('base.group_user'))]"/>
            <field name="implied_ids" eval="[Command.link(ref('base.group_partner_manager'))]"/>
        </record>

        <!-- Rule 3: Portal User có thể xem và cập nhật appointment fields -->
        <record id="res_partner_rule_portal_read" model="ir.rule">
            <field name="name">Res Partner: Portal user có thể xem và cập nhật appointment</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[(1, '=', 1)]</field>  <!-- Portal user có thể xem tất cả partners -->
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>  <!-- Group Portal -->
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>  <!-- Cho phép write để update appointment -->
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

    </data>
</odoo>